---
title: "Tundra Light Extinction Model"
author: "Ruby An"
date: "2024-01-12"
output:
  html_document:
    number_sections: true
  pdf_document: default
editor_options:
  chunk_output_type: console
---



# Introduction

This document describes a multi-species model of tundra plant community dynamics. The goals of this model are to: 

(a) explain the coexistence of multiple species in tundra plant communities, and 
(b) make predictions about community-level outcomes in a changing climate. 

Our approach is to build a simple model informed by the physical structure, demographic processes, and resource requirements common to plant species in tundra environments. We characterize equilibrium dynamics of the model and establish criterion for species coexistence as a function of species' traits. 

We then test how environmental change (warming, longer growing seasons, higher nutrient availability) alters competitive outcomes through a series of simulations. Environmental conditions alter outcomes by impacting species' growth rates, time available for growth, and mortality risk. 

# Model Description



This model tracks the density of ramets ($N_{i}$ -- the number of individual ramets of species $i$ in a given unit area) in continuous time. 

For ease of notation, we order species from tallest to shortest ramet height: 

$$ H_{1} > H_{2} > \cdots > H_{j} > H_{i} > \cdots > H_{Q} \text{ for species } i = 1, 2, ..., Q   $$
In this imagination of the tundra world, ramets never "grow in height", but are instantaneously born at their species-specific height once a "mother ramet" has accumulated enough carbon. This means that each species occupies only one specific height $H_i$ in the canopy at any given point in time. This simplifies the description of the light environment, such that we are able to easily calculate equilibrium environmental conditions, ramet densities, and coexistence criterion. 

![Diagram of the tundra ramet model of light competition.](/Users/ruby/Projects/shrub_model/diagrams/tundra_ramet_world.png) 

## Ramet Allometry

Ramet biomass is related allometrically to height, via the following powerlaw. 

$$ B_i = b H_i^\beta $$

where $b$ is a biomass conversion parameter (e.g. wood density). For forest tree systems from which this model draws inspiration, $\beta = 5$ is typical, since 

\begin{align}
  B &= \text{height * basal area} \\
  & H \propto D^{1/2} \text{ and } \text{basal area} \propto D^2 \\
  & \Rightarrow B \propto D^{5/2} \text{ i.e. } B \propto H^5
\end{align}

We fix ramet crown area to be equal for all species. 

$$ C_i = C_j = c, \quad \forall i,j $$

## Ramet Carbon Economy 

Carbon gain per ramet is determined by light availability. When exposed to a given light level ($L_{R_i}$), ramets gain carbon through photosynthesis ($A(L_{R_i})$) and lose carbon due to respiration and maintenance costs ($r$). The carbon accumulation rate of a ramet of species $i$ when exposed to light level $L_{R_i}$, is given by: 

$$ g_i(L_{R_i}) = A(L_{R_i})  - r$$
$A(L_{R_i})$ is a function describing photosynthesis per ramet. For now, we assume that photosynthesis is a linear function of light availability. 

$$A(L_{R_i}) = a L_{R_i}$$
where $a$ is the rate of carbon gain per ramet. Carbon losses $r$ include leaf respiration and construction costs (i.e. 1 / leaf turnover rate). 

**_NOTE:_** For now, we assume $a$ and $r$ are fixed parameters equal for all species. Since crown area is the same across species, I write the physiological parameters $a$ and $r$ to be rates as carbon gain or loss \textbf{per ramet}. In further models, I may rewrite to explicitly include species specific crown area. In this case, these physiological rates would be written per unit leaf area.


## Ramet Demography

Once a ramet accumulates carbon equivalent to its species-specific biomass ($B_i$), it produces a full-size daughter ramet. This means reproduction is not continuous, but pulsed at a certain interval per species. 

Based on our description of ramet allometry and physiology, we can write an expression for the time required until reproduction ($T_i$),

$$ T_i = \frac{B_i}{g_i(L_{R_i})} $$
At equilibrium, $\hat T_i$ is a fixed value for each species. This value sets the fecundity (birth rate per unit time) of a species.

Ramets die at a constant species-specific mortality rate, $m_i$. 

## Ramet population dynamics

In this model, we track the number of individual ramets per species per unit area (i.e. $X_i(t)$ is the density of species $i$ over time). 

$$\frac{dX_i}{dt} = f_i X_i - m_i X_i = (f_i - m_i)X_i$$

At equilibrium, births and deaths exactly balance and this derivative is zero. Because of the pulsed nature of reproduction assumed in this clonal model, the actual expression for $f_i$ is somewhat complicated. To calculate equilibrium values, it's easier to consider the lifetime reproductive success of a ramet of species $i$. 

 If reproduction were continuous, we could write $f(i) = \frac{1}{T_i}$. However, since reproduction is pulsed, the true value of $f_i$ is slightly lower than this, and a somewhat complicated "floor" function based on intervals of $T_i$. 

To avoid dealing with these discontinuities, it's useful to consider the lifetime reproductive success ($LRS$) of each ramet, i.e. the expected number of offspring per ramet. 

$$LRS(R_i) = \sum_{w=0}^\infty e^{-m_i T_i w}b(w) \quad \text{ where } b(w) = \begin{cases}
   0 &\text{if } w = 0 \\
   1 &\text{if } w > 0
\end{cases}$$

Note that $e^{-m_i T_i w}$ is the probability that the ramet will survive until age $w$. Verbally, this means that each time the ramet lives a time period $T_i$, it has one daughter. The lifetime reproductive success is the sum over all ages of the probability the ramet lives to that age times the number of offspring it produces at that age. When the ramet is age $w = 0$, it has not yet reached $T_i$ and thus does not contribute any offspring. 

If we solve $LRS(R_i) = 1$, we get an expression that relates $T_i$ to mortality rate:

$$T_i = \frac{ln(2)}{m_i}$$ 

In words, time to reproduction at equilibrium must exactly balance the mortality rate. Recall that we already have an expression for $T_i$ bulit from the physiological process of carbon accumulation to make a baby:

$$T_i = \frac{ln(2)}{m_i} =  \frac{B_i}{g_i(L_{R_i})} $$
By setting these equal, we can solve for $\hat L_{R_i}$, the level of light per ramet for the system to be at equilibrium. 

$$\hat L_{R_i} = \frac{1}{a} \left( \frac{m_i B_i}{ln(2) c} + r \right)$$
Based on our formulation of asymmetric light competition, $\hat L_{R_i}$ is a function of $\hat X_j$ for $j \leq i$. This then gives us an expression for the equilibrium density $\hat X_i$. 

## Light Competition and Environment

The first version of this model includes only competition for light, assuming light extinction following Beer's law. Verbally, each speceise occupies one height $H_i$ in the canopy. Definitions: 

\begin{align}
& L_0 &&= 1 && \text { the total light available above the canopy of all species} \\
& L_{i-1} &&= e^{-kc\sum_{j=1}^{i-1}X_j} && \text{ the light available below canopy $i-1$, thus above canopy $i$} \\
& L_{i} &&= e^{-kc\sum_{j=1}^{i}X_j} && \text{ the light available below canopy $i$ } \\
& L_{i}^a && = L_{i-1} - L_{i}  = e^{-kc\sum_{j=1}^{i-1}X_j} (1-e^{-kcX_i}) && \text{ the light absorbed by species $i$} \\
& L_{R_i} &&= \frac{L_{i-1} - L_{i}}{X_i} && \text{ the light available to a single ramet of species } i \\
\end{align}

The light that reaches the canopy height of species $i$ is set by the number of ramets of species taller ($j < i$) than species $i$. Ramets of species $i$ share the light that reaches their canopy equally. 

The light that reaches each ramet $R_i$ depends on: 

1. The light that reaches canopy $i$, $L_{i-1}$ 
2. The size of canopy $i$, i.e. how much light all the ramets of species $i$ block, $(1 - e^{-kc X_i}$)
3. how many ways ramets of species $i$ need to share the captured light, $X_i$.

Each ramet of species $i$ gets an equal "piece of the light" absorebed at that height level. From the demography and physiology of the system, we know the light level required per ramet for the system to be at equilibrium. 

$$\hat L_{R_i} = \frac{1}{a} \left( \frac{m_i B_i}{ln(2) c} + r \right)$$

\begin{align}
& L_{R_i} &&= \frac{L_{i-1} - L_{i}}{X_i} && \text{ the light available to a single ramet of species } i \\
\end{align}


## Light requirement at equlibrium

## Light requirement for establishment

## EQ density with light requirement as a continous trait 

# Simulations 

## Parameters

```
## <environment: R_GlobalEnv>
```



|parameter | value|description             |unit |
|:---------|-----:|:-----------------------|:----|
|a         |   2.0|rate of photosynthesis  |NA   |
|r_l       |   0.3|rate of respiration     |NA   |
|c_l       |   0.3|cost of construction    |NA   |
|b         |   0.5|biomass density         |NA   |
|k         |   0.2|light decay coefficient |NA   |
|v         |  10.0|leaf area per ramet     |NA   |
|beta      |   5.0|height to mass power    |NA   |
|m         |   2.0|ramet mortality         |NA   |

## Light required for establishment
The biomass of a ramet increases in proportion to height to the 5th power. This means that the taller the species, the longer it will take a ramet to accumulate enough carbon to reproduce. We can plot the "light required for a species of height x" to invade from rare, e.g. lifetime reproductive success > 0 assuming no other ramets of the same species, as given below. 

This means that the light must be AT LEAST this level in order for the ramet to invade. 

<img src="ramet_light_competition_model_files/figure-html/unnamed-chunk-1-1.png" width="672" />


## Equilbrium Density of light extinction model w/height reproduction trade-off

This code randomly chooses S number of species with a trait along the light requirement access. It then calculates the equilibrium species density of the species. 
Steps for the code.

1. choose number of species, S
2. set light extinction coefficient, k
3. randomly choose number of species uniformly along light requirement axis (u_min to 1)
4. sequentially calculate equilibrium densities, from tallest species to shortest

Inputs:
- S : number of species in the pool (e.g. 50)
- k : light extinction coefficient 

Outputs: 
- n: vector of equilibrium species density
- u: vector species-specific minimum light level 
- L: vector of light level 


### Equilibrium density as a function of light available - from implicit expression

From the implicit expression for x_i we can solve for the equilibrium densities of each species, based on their light requirement trait and the densities of taller species. 

The more light required, the lower the equilibrium density of the species. 
<img src="ramet_light_competition_model_files/figure-html/unnamed-chunk-2-1.png" width="672" /><img src="ramet_light_competition_model_files/figure-html/unnamed-chunk-2-2.png" width="672" />

### Equilibrium density - sequential solution for multispecies community

#### Functions


## EQ density of community
<img src="ramet_light_competition_model_files/figure-html/unnamed-chunk-4-1.png" width="672" />


### Control vs Shrubified 
<img src="ramet_light_competition_model_files/figure-html/unnamed-chunk-5-1.png" width="672" />

### 10 vs 100 species
<img src="ramet_light_competition_model_files/figure-html/unnamed-chunk-6-1.png" width="672" /><img src="ramet_light_competition_model_files/figure-html/unnamed-chunk-6-2.png" width="672" /><img src="ramet_light_competition_model_files/figure-html/unnamed-chunk-6-3.png" width="672" /><img src="ramet_light_competition_model_files/figure-html/unnamed-chunk-6-4.png" width="672" /><img src="ramet_light_competition_model_files/figure-html/unnamed-chunk-6-5.png" width="672" />

### Biomass plot

Here it's important that the minimum light requirement corrresponds to an actually feasible biomass. 
<img src="ramet_light_competition_model_files/figure-html/unnamed-chunk-7-1.png" width="672" />


## OTHER PLOTS

<img src="ramet_light_competition_model_files/figure-html/unnamed-chunk-8-1.png" width="672" />

## Inter vs. intraspecific competition? 

<img src="ramet_light_competition_model_files/figure-html/unnamed-chunk-9-1.png" width="672" />

